# 修改数据源为H2和修复健康检查接口计划

## 1. 问题分析

### 1.1 数据源配置问题

* 当前两个微服务都使用MySQL数据库
* 需要改为使用H2内存数据库
* 便于开发和测试，无需额外安装MySQL

### 1.2 健康检查接口返回404问题

* 已创建HealthController类，但接口返回404
* 可能的原因：
  - 包结构问题
  - 路径问题
  - 依赖问题
  - 配置问题

## 2. 解决方案

### 2.1 修改数据源为H2

* 更新application.yml文件，将MySQL配置改为H2配置
* 添加H2控制台支持（可选，便于开发调试）
* 修改JPA方言为H2方言

### 2.2 修复健康检查接口

* 检查HealthController的包结构，确保在组件扫描范围内
* 检查接口路径配置
* 检查是否缺少必要的依赖
* 确保Spring Boot应用正确扫描到Controller

## 3. 实施步骤

### 3.1 修改catalog-service的application.yml

1. 将MySQL数据源配置替换为H2配置
2. 添加H2控制台支持
3. 修改JPA方言为H2方言
4. 配置H2数据库的URL、用户名和密码

### 3.2 修改enrollment-service的application.yml

1. 将MySQL数据源配置替换为H2配置
2. 添加H2控制台支持
3. 修改JPA方言为H2方言
4. 配置H2数据库的URL、用户名和密码

### 3.3 检查并修复健康检查接口

1. 确认HealthController的包路径正确
2. 检查@RestController注解是否正确使用
3. 检查@RequestMapping注解是否正确使用
4. 确保Spring Boot应用正确扫描到Controller

## 4. 预期结果

* 两个微服务都使用H2数据库
* H2控制台可以访问（可选）
* 健康检查接口返回正常响应
* 服务可以正常启动和运行

## 5. 技术实现

### 5.1 H2数据源配置示例

```yaml
spring:
  # 数据源配置
  datasource:
    url: jdbc:h2:mem:catalog_db
    username: sa
    password: password
    driver-class-name: org.h2.Driver
  
  # H2 控制台配置
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        trace: false
        web-allow-others: false
  
  # JPA 配置
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
```

### 5.2 健康检查接口修复

* 确认HealthController的包路径在主应用类的包或子包下
* 确认@RestController和@RequestMapping注解正确使用
* 确保没有配置错误的路径前缀

## 6. 实施顺序

1. 先修改catalog-service的application.yml
2. 再修改enrollment-service的application.yml
3. 检查并修复健康检查接口
4. 测试服务启动和接口访问

