# 微服务拆分实现计划

## 1. 当前状态分析

* 已创建两个服务目录：`catalog-service` 和 `enrollment-service`

* `catalog-service` 已实现课程管理功能

* `enrollment-service` 存在问题：直接依赖 `catalog-service` 的代码，不符合微服务架构设计

## 2. 实现目标

* 将单体应用拆分为两个独立的微服务

* 实现基于HTTP的服务间通信

* 确保两个服务可以独立运行

* 提供完整的API文档

## 3. 详细实现步骤

### 3.1 修改 enrollment-service

#### 3.1.1 移除直接依赖

* 删除 `pom.xml` 中对 `catalog-service` 的依赖

* 移除所有 `com.zjgsu.ms.hxy.catalog` 包的导入

* 修改 `EnrollmentService`，移除对 `CourseService` 和 `Course` 模型的直接依赖

#### 3.1.2 配置 RestTemplate

* 在 `EnrollmentServiceApplication` 中添加 `RestTemplate` Bean 配置

* 在 `application.yml` 中添加 `catalog-service.url` 配置

#### 3.1.3 实现 HTTP 服务调用

* 修改 `EnrollmentService.enrollCourse()` 方法：

  * 使用 `RestTemplate` 调用 `catalog-service` 验证课程存在性

  * 使用 `RestTemplate` 调用 `catalog-service` 检查课程容量

  * 使用 `RestTemplate` 调用 `catalog-service` 更新课程人数

* 修改 `EnrollmentService.withdrawCourse()` 方法：

  * 使用 `RestTemplate` 调用 `catalog-service` 减少课程人数

#### 3.1.4 添加异常处理

* 添加服务间调用的异常处理

* 添加资源不存在的异常处理

* 添加业务逻辑异常处理

### 3.2 完善 catalog-service

#### 3.2.1 确保 API 兼容性

* 确保 `catalog-service` 提供的 API 符合 `enrollment-service` 的调用需求

* 添加必要的 API 端点，如更新课程人数的端点

#### 3.2.2 完善配置

* 确保 `catalog-service` 运行在指定的 8081 端口

* 确保数据库连接配置正确

### 3.3 生成 API 文档

#### 3.3.1 为 catalog-service 生成 OpenAPI 文档

* 确保 `catalog-service` 的 `openapi.yaml` 文档完整

* 包含所有课程管理 API 端点

#### 3.3.2 为 enrollment-service 生成 OpenAPI 文档

* 创建 `enrollment-service` 的 `openapi.yaml` 文档

* 包含所有学生管理和选课管理 API 端点

### 3.4 测试服务间通信

<br />

你完成代码内容即可，调试由我来调试，调试不需要你进行

<br />

## 4. 预期结果

* 两个独立的微服务应用

* 基于 HTTP 的服务间通信

* 完整的 API 文档

* 功能完整的选课系统

## 5. 技术栈

* Spring Boot 3.x

* Java 25

* MySQL 8.x

* Docker & Docker Compose

* RestTemplate（服务间通信）

* OpenAPI（API 文档）

